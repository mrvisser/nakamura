<?xml version="1.0" encoding="UTF-8"?>
<infinispan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="urn:infinispan:config:5.2 http://www.infinispan.org/schemas/infinispan-config-5.1.xsd"
	xmlns="urn:infinispan:config:5.1">

	<global>
		<globalJmxStatistics enabled="false" />
	</global>

	<namedCache name="EntityCache">
		<!-- Cache that holds all the indexed IndexDocuments -->

		<!-- Indexing configuration -->
		<indexing enabled="true" indexLocalOnly="true">
			<properties>
				<property name="hibernate.search.default.directory_provider"
					value="filesystem" />
				<property name="hibernate.search.default.indexBase" value="storage/indexes" />
			</properties>
		</indexing>

		<!-- Cache-Loader persistence configuration -->
		<loaders shared="false">
			<loader
				class="org.infinispan.loaders.jdbc.stringbased.JdbcStringBasedCacheStore"
				fetchPersistentState="true" ignoreModifications="false"
				purgeOnStartup="false">
				<properties>
					<property name="driverClass" value="org.apache.derby.jdbc.EmbeddedDriver" />
					<property name="connectionUrl" value="jdbc:derby:storage/db;create=true" />
					<property name="userName" value="sa" />
					<property name="password" value="" />
					<!-- pooling -->
					<property name="connectionFactoryClass"
						value="org.infinispan.loaders.jdbc.connectionfactory.PooledConnectionFactory" />

					<!-- table management -->
					<property name="dropTableOnExit" value="false" />
					<property name="createTableOnStart" value="true" />
					<property name="cacheName" value="ix" />
					<property name="idColumnName" value="id" />
					<property name="idColumnType" value="varchar(255)" />
					<property name="dataColumnName" value="data" />
					<property name="dataColumnType" value="blob" />
					<property name="timestampColumnName" value="updated" />
					<property name="timestampColumnType" value="bigint" />
					<property name="stringsTableNamePrefix" value="str" />
				</properties>
			</loader>
		</loaders>
		
		<!-- TODO: What should maxEntries be? -->
		<eviction maxEntries="250000" strategy="LRU" />
		
		<!-- Transaction configuration -->
		<transaction transactionManagerLookupClass="org.infinispan.transaction.lookup.JBossStandaloneJTAManagerLookup"
      		transactionMode="TRANSACTIONAL" lockingMode="OPTIMISTIC" />
	</namedCache>
</infinispan>